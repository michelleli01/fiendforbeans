<!DOCTYPE html>
<title>Fiend 4 Beans</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Kanit&family=Montserrat&family=Open+Sans:wght@500&display=swap"
  rel="stylesheet"
/>

<body>
  <link href="styles.css" type="text/html" />

  <div class="full-body-container">
    <!-- <div class="top-text">
            <div class="google-colors">
                <h1 id="google-c">C</h1>
                <h1 id="google-s">S</h1>
                <h1 id="google-4">4</h1>
                <h1 id="google-3">3</h1>
                <h1 id="google-0-1">0</h1>
                <h1 id="google-0-2">0</h1>
            </div> -->
    <img
      style="padding-top: 10%; width: 40%; margin-bottom: 1rem"
      src="/static/images/logo.png"
      alt="Fiend for Beans logo"
    />
    <label for="input-box">Enter which flavor profiles you enjoy.</label>
    <div class="input-box" onclick="sendFocus(1)">
      <div>
        <input
          placeholder="citrus, floral, sweet"
          id="filter-text-val"
          oninput="updateButtonStatus()"
        />
      </div>
      <!--       <img src="{{ url_for('static', filename='images/mag.png') }}" />-->
    </div>

    <label for="dropdown">Select which roast you prefer.</label>
    <div class="dropdown">
      <select
        name="roast"
        id="roast_select"
        onchange="updateRoast(this.value);"
      >
        <option value="Light" selected>Light</option>
        <option value="Medium-Light">Medium-Light</option>
        <option value="Medium">Medium</option>
        <option value="Medium-Dark">Medium-Dark</option>
        <option value="Dark">Dark</option>
      </select>
    </div>

    <!--
    <label for="input-box">Enter preferred country of origin.</label>
    <div class="input-box" onclick="sendFocus(2)">
      <div>
        <input
          placeholder="United States, Taiwan"
          id="country-text-val"
          oninput="updateButtonStatus()"
        />
      </div>
    </div>
    -->
    <br />
    <button id="search-button" onCLick="filterText()">Search</button>
  </div>
  <div id="answer-box"></div>

  <script>
    var flavor_prof = document.getElementById('filter-text-val').value;
    var roast_value = document.getElementById('roast_select').value;

    function updateFlavorProf() {
      flavor_prof = document.getElementById('filter-text-val').value;
    }

    function updateRoast() {
      roast_value = document.getElementById('roast_select').value;
      console.log(roast_value);
    }
    function answerBoxTemplate(title, similarity, titleDesc, roast) {
      return `<div>
                <h2 class='bean-title'>${title}</h3>
                <p class='bean-similarity'>Percent Confidence: ${similarity}</p>
                <p class='bean-similarity'>Roast: ${roast}</p>
                <p class='bean-desc'>${titleDesc}</p>
            </div>`;
    }

    function updateButtonStatus() {
      const input = document.getElementById('filter-text-val').value;
      const button = document.getElementById('search-button').value;
      button.style.color = input === '' ? 'lightgrey' : 'black';
    }

    function sendFocus() {
      document.getElementById('filter-text-val').focus();
      document.getElementById('roast-text-val').focus();
    }

    function filterText() {
      if (document.getElementById('filter-text-val').value === '') return;

      document.getElementById('answer-box').innerHTML = '';
      console.log(document.getElementById('filter-text-val').value);
      console.log(document.getElementById('roast_select').value);

      fetch(
        '/beans?' +
          new URLSearchParams({
            flavor_prof: document.getElementById('filter-text-val').value,
            roast_value: document.getElementById('roast_select').value,
          }).toString()
      )
        .then((response) => response.json())
        .then((data) => {
          if (data.length === 0) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML =
              'No coffee beans match your query. Please try again :)';
            tempDiv.style.textAlign = 'center';
            tempDiv.style.marginTop = '5rem';
            tempDiv.style.fontSize = '18px';
            tempDiv.style.fontFamily = 'Montserrat, sans-serif';
            document.getElementById('answer-box').appendChild(tempDiv);
            return;
          }

          data.forEach((d) => {
            let bean = d.bean_info;
            let score = d.score;
            let percentConfidence = `${score.toFixed(2) * 100}%`;
            let tempDiv = document.createElement('div');
            tempDiv.innerHTML = answerBoxTemplate(
              bean.name,
              percentConfidence,
              bean.review,
              bean.roast
            );
            document.getElementById('answer-box').appendChild(tempDiv);
          });
        });
    }
  </script>
</body>
